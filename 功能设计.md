# 数据库设计

## 用户表 (users)
| 字段 | 类型 | 大小 | 说明 |
| :--- | :--- | :--- | :--- |
| id | BIGINT | 20 | 主键ID |
| username | VARCHAR | 50 | 用户名 (账号) |
| password | VARCHAR | 100 | 加密后的密码 |
| real_name | VARCHAR | 50 | 真实姓名 |
| role | INT | 4 | 角色: 0-普通用户, 1-管理员 |
| phone | VARCHAR | 20 | 联系电话 |
| status | INT | 4 | 状态: 1-正常, 0-禁用 |
| created_time | DATETIME | - | 创建时间 |

## 图书表 (books)
| 字段 | 类型 | 大小 | 说明 |
| :--- | :--- | :--- | :--- |
| id | BIGINT | 20 | 主键ID |
| title | VARCHAR | 100 | 图书名称 |
| author | VARCHAR | 50 | 作者 |
| publisher | VARCHAR | 50 | 出版社 |
| isbn | VARCHAR | 20 | ISBN编码 |
| cover_url | VARCHAR | 255 | 封面图片地址 |
| category_id | BIGINT | 20 | 关联分类ID |
| stock | INT | 11 | 当前库存数量 |
| location | VARCHAR | 50 | 存放位置 (如A区1架) |
| description | VARCHAR | 500 | 图书简介 |
| status | INT | 4 | 状态: 1-上架, 0-下架 |

## 图书分类表 (categories)
| 字段 | 类型 | 大小 | 说明 |
| :--- | :--- | :--- | :--- |
| id | BIGINT | 20 | 主键ID |
| name | VARCHAR | 50 | 分类名称 |
| parent_id | BIGINT | 20 | 父级ID (支持层级) |
| level | INT | 4 | 层级深度 |
| sort_order | INT | 4 | 排序优先级 |

## 借阅记录表 (borrow_records)
| 字段 | 类型 | 大小 | 说明 |
| :--- | :--- | :--- | :--- |
| id | BIGINT | 20 | 主键ID |
| user_id | BIGINT | 20 | 用户ID |
| book_id | BIGINT | 20 | 图书ID |
| borrow_time | DATETIME | - | 借阅时间 |
| due_time | DATETIME | - | 应还时间 |
| return_time | DATETIME | - | 实际归还时间 |
| status | INT | 4 | 状态: 1-借阅中, 2-已归还, 3-已超期 |
| remark | VARCHAR | 200 | 备注 |

## 系统公告表 (announcements)
| 字段 | 类型 | 大小 | 说明 |
| :--- | :--- | :--- | :--- |
| id | BIGINT | 20 | 主键ID |
| title | VARCHAR | 100 | 公告标题 |
| content | TEXT | - | 公告内容 |
| admin_id | BIGINT | 20 | 发布管理员ID |
| publish_time | DATETIME | - | 发布时间 |
| is_top | INT | 4 | 是否置顶: 1-是, 0-否 |

# 用户管理模块

## API设计
### 用户管理API表
| 端点 | 方法 | 描述 |
| :--- | :--- | :--- |
| /api/users/register | POST | 用户注册接口 |
| /api/users/login | POST | 用户登录接口 |
| /api/users/profile | GET | 获取个人信息接口 |
| /api/users/profile/update | PUT | 修改个人信息接口 |
| /api/admin/users/list | GET | (管理员)获取用户列表 |
| /api/admin/users/status | PUT | (管理员)修改用户状态 |

## 后端设计
1. 实现用户注册服务的业务逻辑，包括校验用户名是否存在，密码加密存储（推荐使用BCrypt）。
2. 实现登录认证功能，验证账号密码，生成JWT令牌并返回给客户端。
3. 创建个人信息管理Service，支持查询当前登录用户信息及更新基本资料。
4. 开发管理员权限控制切面（AOP），确保只有角色为管理员的用户能访问后台管理接口。
5. 实现用户状态管理功能，允许管理员禁用违规用户账号。

## 前端设计
1. 设计并实现登录/注册页面，包含表单验证（如密码强度、必填项检查）。
2. 构建个人中心页面，展示用户头像、昵称等信息，提供修改资料的表单模态框。
3. 开发用户管理列表页（仅管理员可见），展示所有注册用户，提供搜索和状态切换开关。
4. 实现本地存储逻辑，保存Token及用户信息，实现路由守卫（Navigation Guard），未登录拦截跳转。

# 图书信息管理模块

## API设计
### 图书管理API表
| 端点 | 方法 | 描述 |
| :--- | :--- | :--- |
| /api/books | GET | 分页查询图书列表 |
| /api/books/{id} | GET | 获取图书详情 |
| /api/admin/books | POST | (管理员)新增图书 |
| /api/admin/books | PUT | (管理员)修改图书 |
| /api/admin/books/{id} | DELETE | (管理员)删除图书 |

## 后端设计
1. 实现图书多条件查询功能（规格书），支持书名、作者、ISBN的模糊搜索，并结合PageHelper实现分页。
2. 开发图书新增接口，需校验ISBN唯一性，同时验证分类ID的有效性。
3. 实现图书信息更新逻辑，支持乐观锁控制并发修改（可选），处理库存数量变更。
4. 编写图书逻辑删除功能，将状态标记为下架或删除，保留数据记录以备查账。

## 前端设计
1. 搭建图书列表展示组件，使用卡片式布局展示封面、书名和作者，支持上拉加载或分页器。
2. 开发图书详情页，从URL参数获取ID并请求详情数据渲染。
3. 构建图书管理后台页面，包含复杂的表格组件，支持行内编辑或弹窗编辑图书信息。
4. 实现图片上传组件，支持图书封面的预览和上传（可后端存储或Base64）。

# 图书分类管理模块

## API设计
### 分类管理API表
| 端点 | 方法 | 描述 |
| :--- | :--- | :--- |
| /api/categories/tree | GET | 获取分类树形结构 |
| /api/admin/categories | POST | (管理员)新增分类 |
| /api/admin/categories | PUT | (管理员)修改分类 |
| /api/admin/categories/{id} | DELETE | (管理员)删除分类 |
| /api/categories/{id}/stats | GET | 获取某分类下图舒统计 |

## 后端设计
1. 实现递归算法或使用数据库递归查询（如MySQL 8.0 CTE）构建分类树形结构返回给前端。
2. 开发分类维护接口，在删除分类前必须校验该分类下是否还有图书关联，防止数据不一致。
3. 实现分类统计逻辑，通过聚合查询（GROUP BY）计算各分类下的图书总数。

## 前端设计
1. 开发树形控件（Tree Component），直观展示一级和二级分类，支持展开/收起。
2. 在图书筛选区域实现分类级联选择器，方便用户按类别查找图书。
3. 构建分类管理页面，支持分类节点的增删改，拖拽排序（进阶）。
4. 实现数据可视化图表（如饼图），展示馆藏图书的分类分布情况。

# 图书借阅管理模块

## API设计
### 借阅管理API表
| 端点 | 方法 | 描述 |
| :--- | :--- | :--- |
| /api/borrow/apply | POST | 申请借阅图书 |
| /api/borrow/return | POST | 归还图书 |
| /api/borrow/my-records | GET | 获取我的借阅记录 |
| /api/admin/borrow/list | GET | (管理员)获取所有借阅记录 |
| /api/admin/borrow/overdue | GET | (管理员)获取超期列表 |

## 后端设计
1. 实现借阅申请的核心业务：校验库存是否充足、用户是否有未还超期书籍、是否达到最大借阅数量，全部通过后扣减库存并生成借阅记录。
2. 开发归还逻辑，根据RecordID更新归还时间，计算是否超期，释放库存。
3. 编写定时任务（Spring Scheduled），每天凌晨扫描借阅表，将超过应还时间且未还的记录状态更新为"已超期"。
4. 实现借阅历史查询功能，支持按时间范围筛选记录。

## 前端设计
1. 在图书详情页添加"立即借阅"按钮，根据当前库存和用户借阅状态动态控制按钮可用性（Disable）。
2. 开发个人借阅中心页面，使用标签页（Tabs）区分"借阅中"、"已归还"和"超期"记录。
3. 借阅列表项需展示倒计时或超期天数，醒目提示用户归还。
4. 管理员端提供借阅报表页面，可查看每日借还流水和异常未还记录。

# 系统首页展示模块

## API设计
### 首页数据API表
| 端点 | 方法 | 描述 |
| :--- | :--- | :--- |
| /api/home/stats | GET | 获取系统基础统计数据 |
| /api/home/recommend | GET | 获取推荐图书列表 |
| /api/announcements/top | GET | 获取首页公告列表 |

## 后端设计
1. 聚合首页统计接口，高效查询图书总数、当前借出总数、注册用户数等指标。
2. 实现推荐算法逻辑，初期可简单实现为"最新上架"或"借阅量最高"的Top N图书查询。
3. 开发公告查询接口，按置顶标记和发布时间倒序获取最新的几条公告。
4. 提供全局搜索接口，整合图书和公告的搜索结果。

## 前端设计
1. 设计响应式首页布局，包含顶部导航栏、轮播图区域（展示推荐图书或公告）、数据统计仪表盘。
2. 开发公告滚动栏或列表组件，点击可跳转查看公告详情。
3. 实现全局搜索框，支持即时搜索建议（Debounce处理）。
4. 首页数据展示需增加骨架屏（Skeleton）加载效果，提升用户体验。
